@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
    
*@
@{
   
   
    ViewData["Title"] = "Twitter Users REST Client";
    bool imported = ViewBag.JsonImported ?? false;
}



<h2>Twitter Users REST Client</h2>
<hr />

<!-- 1. Import JSON from API -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">Step 1: Import JSON from API</div>
    <div class="card-body">
        <form asp-action="ImportJsonFromApi" method="post">
            <button type="submit" class="btn btn-primary" @(imported ? "disabled" : "")>
                Import JSON from API
            </button>
        </form>
        @if (ViewBag.JobInfo != null)
        {
            <div class="alert alert-info mt-2">@ViewBag.JobInfo</div>
        }
    </div>
</div>

@if (imported)
{
    <!-- 2. Search by Username -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">Step 2: Search User by Username</div>
        <div class="card-body">
            <form asp-action="SearchUserByUsername" method="post">
                <label>Username:</label>
                <input type="text" name="username" class="form-control mb-2" required />
                <button type="submit" class="btn btn-secondary">Search</button>
            </form>
            @if (ViewBag.SearchUserResult != null)
            {
                <label>Search Result:</label>
                <pre>@ViewBag.SearchUserResult</pre>
            }
        </div>
    </div>

    <!-- 3. Local CRUD Section -->
    <h2 class="mt-4 mb-3">Local Twitter Users CRUD</h2>
    <div class="row">
        <!-- POST (Create) -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-success text-white">Create User (POST)</div>
                <div class="card-body">
                    <form asp-action="CreateUser" method="post">
                        <label>New User (JSON):</label>
                        <textarea name="jsonData" rows="8" class="form-control mb-2" required></textarea>
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-success">Create</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="insertSampleJson('post')">Sample JSON</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- PUT (Update) -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">Update User (PUT)</div>
                <div class="card-body">
                    <form asp-action="UpdateUser" method="post">
                        <label>Update User by ID:</label>
                        <input type="text" name="id" class="form-control mb-2" placeholder="User ID" required />
                        <textarea name="jsonData" rows="8" class="form-control mb-2" required></textarea>
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-warning">Update</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="insertSampleJson('put')">Sample JSON</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- DELETE -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-danger text-white">Delete User (DELETE)</div>
                <div class="card-body">
                    <form asp-action="DeleteUser" method="post">
                        <label>Delete User by ID:</label>
                        <input type="text" name="id" class="form-control mb-2" placeholder="User ID" required />
                        <button type="submit" class="btn btn-danger w-100">Delete</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- GET ALL -->
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header bg-info text-white">Get All Users (GET)</div>
                <div class="card-body">
                    <form asp-action="GetAllUsers" method="post">
                        <button type="submit" class="btn btn-info">Show All Users</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning mt-3">
        <strong>Notice:</strong> You must import JSON from API before using search or CRUD.
    </div>
}

<!-- Results section -->
@if (ViewBag.LocalApiResult != null)
{
    <h4>API Result:</h4>
    <pre>@ViewBag.LocalApiResult</pre>
}
@if (ViewBag.LocalApiAll != null)
{
    <h4>All Twitter Users:</h4>
    <pre>@ViewBag.LocalApiAll</pre>
}

@section Scripts {
    <script>
        function insertSampleJson(formType) {
            const postSample = `{
                "username": "dev3",
                "name": "Developer Three",
                "follower_count": 150,
                "following_count": 80,
                "description": "Third user",
                "location": "Germany",
                "profile_pic_url": ""
            }`;
            const putSample = `{
                "username": "updated_dev3",
                "name": "Updated Developer Three",
                "follower_count": 200,
                "following_count": 100,
                "description": "Updated description",
                "location": "Berlin",
                "profile_pic_url": ""
            }`;
            if (formType === 'post') {
                document.getElementsByName('jsonData')[0].value = postSample;
            } else if (formType === 'put') {
                document.getElementsByName('jsonData')[1].value = putSample;
            }
        }
    </script>
}