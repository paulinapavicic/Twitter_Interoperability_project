@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
    
*@
@{
   
   
    ViewData["Title"] = "Twitter Users REST Client";
    bool imported = ViewBag.JsonImported ?? false;
}


<h2>Twitter Users REST Client</h2>
<hr />


<!-- Step 1: Search & Import -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">Step 1: Search Twitter User</div>
    <div class="card-body">
        <form asp-action="ImportJson" method="post">
            <div class="input-group">
                <input type="text" name="username" class="form-control"
                       placeholder="Enter Twitter username" required />
                <button type="submit" class="btn btn-primary" @(imported ? "disabled" : "")>
                    Search & Save
                </button>
            </div>
        </form>
        @if (ViewBag.JobInfo != null)
        {
            <div class="alert alert-info mt-2">@ViewBag.JobInfo</div>
        }
    </div>
</div>




<!-- CRUD Operations -->
<div class="card mb-4">
    <div class="card-header bg-success text-white">Manage Users</div>
    <div class="card-body">
        <!-- Create -->
        <h5>Create New User</h5>
        <form asp-action="CreateUser" method="post" class="mb-4" id="createForm">
            <div class="row g-3">
               
                <div class="col-md-3">
                    <input type="text" name="username" class="form-control" placeholder="Username" required>
                </div>
                <div class="col-md-3">
                    <input type="text" name="name" class="form-control" placeholder="Name">
                </div>
                <div class="col-md-3">
                    <input type="number" name="follower_count" class="form-control" placeholder="Followers">
                </div>
                <div class="col-md-3">
                    <input type="number" name="following_count" class="form-control" placeholder="Following">
                </div>
                <div class="col-md-3">
                    <input type="text" name="description" class="form-control" placeholder="Description">
                </div>
                <div class="col-md-3">
                    <input type="text" name="location" class="form-control" placeholder="Location">
                </div>
                <div class="col-md-3">
                    <input type="text" name="profile_pic_url" class="form-control" placeholder="Profile Pic URL">
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-success">Create</button>
                </div>
            </div>
        </form>

        <!-- Update -->
        <h5>Update User</h5>
        <form asp-action="UpdateUser" method="post" class="mb-4" id="updateForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" name="userId" class="form-control" placeholder="User ID to update" required>
                </div>
                <div class="col-md-4">
                    <input type="text" name="username" class="form-control" placeholder="New username">
                </div>
                <div class="col-md-3">
                    <input type="text" name="name" class="form-control" placeholder="New Name">
                </div>
                <div class="col-md-3">
                    <input type="number" name="follower_count" class="form-control" placeholder="New Followers">
                </div>
                <div class="col-md-3">
                    <input type="number" name="following_count" class="form-control" placeholder="New Following">
                </div>
                <div class="col-md-3">
                    <input type="text" name="description" class="form-control" placeholder="New Description">
                </div>
                <div class="col-md-3">
                    <input type="text" name="location" class="form-control" placeholder="New Location">
                </div>
                <div class="col-md-3">
                    <input type="text" name="profile_pic_url" class="form-control" placeholder="New Profile Pic URL">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-warning">Update</button>
                </div>
            </div>
        </form>

       



        <!-- Display All Users -->
        <div class="card mt-4">
            <div class="card-header bg-info text-white">Saved Users</div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Name</th>
                            <th>Followers</th>
                            <th>Following</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in ViewBag.Users ?? new List<TwitterUser>())
                        {
                            <tr>
                                <td>@user.user_id</td>
                                <td>@user.username</td>
                                <td>@user.name</td>
                                <td>@user.follower_count</td>
                                <td>@user.following_count</td>
                                <td>
                                   
                                    <button type="button" class="btn btn-sm btn-warning"
                                            onclick="populateUpdateForm('@user.user_id', '@user.username', '@user.name', '@user.follower_count', '@user.following_count', '@Html.Raw(Html.Encode(user.description))', '@Html.Raw(Html.Encode(user.location))', '@Html.Raw(Html.Encode(user.profile_pic_url))')">
                                        Edit
                                    </button>

                                    <form asp-action="DeleteUser" method="post" style="display:inline;"
                                          onsubmit="return confirm('Are you sure you want to delete this user?')">
                                        <input type="hidden" name="userId" value="@user.user_id" />
                                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                    </form>
                                </td>

                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>


@section Scripts {
    <script>
                function populateUpdateForm(userId, username, name, followerCount, followingCount, description, location, profilePicUrl) {
            var form = document.getElementById('updateForm');
            form.querySelector('input[name="userId"]').value = userId;
            form.querySelector('input[name="username"]').value = username;
            form.querySelector('input[name="name"]').value = name;
            form.querySelector('input[name="follower_count"]').value = followerCount;
            form.querySelector('input[name="following_count"]').value = followingCount;
            form.querySelector('input[name="description"]').value = description;
            form.querySelector('input[name="location"]').value = location;
            form.querySelector('input[name="profile_pic_url"]').value = profilePicUrl;

           
            form.scrollIntoView({ behavior: 'smooth' });
        }

    </script>
}
